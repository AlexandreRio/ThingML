import "../../../../../org.thingml.samples/src/main/thingml/thingml.thingml"

thing TestHistoryStatesWithStream includes Test
@test "yzyznyniyziyzniyz # I1313412I24I243I23"

{
	statechart TestHistoryStates init I {
	
		state I {
			on entry harnessOut!testOut('\'I\'')
			
			transition -> C1
			stream s1 from event harnessIn?testIn
			trigger s1->c == '\'y\''
			
			transition -> C2
			stream s2 from event harnessIn?testIn
			trigger s2->c == '\'z\''
		}
		
		composite state C1 init C1S1 keeps history {
		
		transition -> I
		stream s3 from event m : harnessIn?testIn
		trigger s3->c == '\'i\''

		transition -> C2
		stream s4 from event m : harnessIn?testIn
		trigger s4->c == '\'z\''
		
			state C1S1 {
				on entry harnessOut!testOut('\'1\'')

				transition -> C1S2
				stream s5 from event m : harnessIn?testIn
				trigger s5->c == '\'n\''
			}
			
			state C1S2 {
				on entry harnessOut!testOut('\'2\'')

				transition -> C1S1
				stream s6 from event m : harnessIn?testIn
				trigger s6->c == '\'m\''
			}
		}	
		
		composite state C2 init C2S1 keeps history {
				
			transition -> I
			stream s1 from event m : harnessIn?testIn
			trigger s1->c == '\'i\''
    
			transition -> C1
			stream s2 from event m : harnessIn?testIn
			trigger s2->c == '\'y\''
				
			state C2S1 {	
				on entry harnessOut!testOut('\'3\'')
    
				transition -> C2S2
				stream s3 from event m : harnessIn?testIn
				trigger s3->c == '\'n\''
			}
				
			state C2S2 {
				on entry harnessOut!testOut('\'4\'')

				transition -> C2S1
				stream s1 from event m : harnessIn?testIn
				trigger s1->c == '\'n\''
			}
		}
	}
}